---
title: "Homework Assignment #2"
subtitle: "Exploring patterns of environmental justice"
author: "Jordan Sibley"
date: last-modified
execute: 
  eval: true
  message: false
  warning: false
format:
  html:
    toc: true
editor_options: 
code-fold: true
---

Note to self: When I render this, there are messages that pop up when reading in the data, how do I fix this?

## Set up

```{r}
# load libraries 
library(tidyverse)
library(here)
library(tmap)
library(dplyr)
library(sf)

```

```{r}
# read in data 

la_holc <- sf::st_read(here::here("data", "mapping-inequality", "mapping-inequality-los-angeles.json"))

la_birds <- sf::st_read(here::here("data", "gbif-birds-LA", "gbif-birds-LA.shp"))

ejscreen <- sf::st_read(here::here("data","ejscreen","EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb")) 
```

## Cleaning Data

```{r}
# filtering ejscreen to only include counties that make up the greater LA area 

la_ej <- ejscreen %>% 
  dplyr::filter(STATE_NAME == "California") %>% 
  dplyr::filter(CNTY_NAME %in% c("Los Angeles County", "San Bernardino County", "Orange County")) %>% 
  dplyr::filter((ID != '060379902000') & (ID != '060379903000')) # remove blocks in are in the ocean
```

```{r}
# removing NA values in the 'grade' column of la_holc
la_holc <- la_holc %>% 
  filter(!is.na(grade)) # remove the 1 NA value
```

## Exploring the Data

#### Looking at the class

```{r}
class(la_holc) 

class(la_ej)
```

Both data sets are sf data frames.

#### Determining the Coordinate Reference Systems

```{r}
# check that the coordinate reference systems match 
if(st_crs(la_holc) == st_crs(la_ej)) {
  print("The coordinate reference systems match")
} else {
  print("The coordinate reference systems do NOT match. Transformation of CRS is recommended.")
}
```

The CRS of `la_holc` and `la_ej` are not the same. In order to use these two data sets in the same map, the CRS of one needs to be transformed to match the other

```{r}
# ensures the CRS of the two datasets will match 
la_holc = st_transform(la_holc, crs = st_crs(la_ej))

# check to see if that worked 
if(st_crs(la_holc) == st_crs(la_ej)) {
  print("The coordinate reference systems now match")
} else {
  warning("The coordinate reference systems still do NOT match. Check that you did the transformation correctly")
}
```

Now the CRS of each data set is matched. 

## Part 1: Legacy of redlining in current environmental (in)justice

Your first task is to explore historical redlining in Los Angeles and its legacy on present-day environmental justice.

#### Description

1.  a map of historical redlining neighborhoods, including:

-   neighborhoods colored by HOLC grade
-   an appropriate base map

```{r}

# map of la county with the holc grades 
tmap_mode('plot')
bbox_la <- st_bbox(la_holc) # bounding box to area of county with holc grades 


tm_shape(la_ej, bbox = bbox_la) +
  tm_polygons(col = "#EFDECD") + # county background color 
tm_shape(la_ej) +
  tm_borders(col = "#D6BA98") + # block border colors 
tm_shape(la_holc) +
  tm_polygons("grade", # la map colored by grade 
              palette = c("#76a865", "#7cb5bd", "#ffff00", "#d9838d"),
              title = "HOLC Grade") +
  tm_credits("Pacific Ocean", position = c(0.03, 0.3)) + # pacific ocean label 
   
  tm_scale_bar(position = c(0.65, 0.9)) + # scale bar
  tm_compass(position = c(0.6, 0.9), size = 1)+ # compass
  tm_layout(bg.color = "#D7F7FD", # blue background color 
            legend.outside = TRUE,
            main.title = "Los Angeles County Historic Redlining Neighborhoods",
            ) 
   

```

Need to figure out how to add a subtitle 
subtitle = Home Ownersâ€™ Loan Corporation (HOLC) neighborhood rating system from the 1930's. Grades were determined based on their perceived safety for real estate investment. The ranking system is as follows: A "Best", B "Still desirable", C "Declining", D "Hazardous". 




2.  a table summarizing the percent of current census block groups within each HOLC grade (or none)

st_intersect is most appropriate 
kable to make table kableExtra

3.  a set of figures summarizing current conditions (from the EJScreen data) within HOLC grades using the mean of the following variables:

-   \% low income
-   percentile for Particulate Matter 2.5
-   percentile for low life expectancy

4.  brief paragraph reflecting on these results

## Part 2: Legacy of redlining in biodiversity observations

Your second task is to explore the legacy of historical redlining in Los Angeles on the collection of bird observations.

#### Description

For this assignment, you must produce the following based on observations from 2022:

1.  a figure summarizing the percent of observations within redlined neighborhoods within each HOLC grade
2.  a brief paragraph explaining whether these results match the findings from Ellis-Soto et al. 2023
